!function(e){e.fn.gMap=function(o,a){switch(o){case"addMarker":return e(this).trigger("gMap.addMarker",[a.latitude,a.longitude,a.content,a.icon,a.popup]);case"centerAt":return e(this).trigger("gMap.centerAt",[a.latitude,a.longitude,a.zoom]);case"clearMarkers":return e(this).trigger("gMap.clearMarkers")}var r=e.extend({},e.fn.gMap.defaults,o);return this.each(function(){var o=new google.maps.Map(this);e(this).data("gMap.reference",o);var a=new google.maps.Geocoder;r.address?a.geocode({address:r.address},function(e){e&&e.length&&o.setCenter(e[0].geometry.location)}):r.latitude&&r.longitude?o.setCenter(new google.maps.LatLng(r.latitude,r.longitude)):e.isArray(r.markers)&&r.markers.length>0?r.markers[0].address?a.geocode({address:r.markers[0].address},function(e){e&&e.length>0&&o.setCenter(e[0].geometry.location)}):o.setCenter(new google.maps.LatLng(r.markers[0].latitude,r.markers[0].longitude)):o.setCenter(new google.maps.LatLng(34.885931,9.84375)),o.setZoom(r.zoom),o.setMapTypeId(google.maps.MapTypeId[r.maptype]);var n={scrollwheel:r.scrollwheel,disableDoubleClickZoom:!r.doubleclickzoom};r.controls===!1?e.extend(n,{disableDefaultUI:!0}):0!=r.controls.length&&e.extend(n,r.controls,{disableDefaultUI:!0}),o.setOptions(n);var s=new google.maps.Marker;marker_icon=new google.maps.MarkerImage(r.icon.image),marker_icon.size=new google.maps.Size(r.icon.iconsize[0],r.icon.iconsize[1]),marker_icon.anchor=new google.maps.Point(r.icon.iconanchor[0],r.icon.iconanchor[1]),s.setIcon(marker_icon),r.icon.shadow&&(marker_shadow=new google.maps.MarkerImage(r.icon.shadow),marker_shadow.size=new google.maps.Size(r.icon.shadowsize[0],r.icon.shadowsize[1]),marker_shadow.anchor=new google.maps.Point(r.icon.shadowanchor[0],r.icon.shadowanchor[1]),s.setShadow(marker_shadow)),e(this).bind("gMap.centerAt",function(e,a,r,n){n&&o.setZoom(n),o.panTo(new google.maps.LatLng(parseFloat(a),parseFloat(r)))});var t=[];e(this).bind("gMap.clearMarkers",function(){for(;t[0];)t.pop().setMap(null)});var i;e(this).bind("gMap.addMarker",function(e,a,n,g,d,l){var c=new google.maps.LatLng(parseFloat(a),parseFloat(n)),m=new google.maps.Marker({position:c});if(d?(marker_icon=new google.maps.MarkerImage(d.image),marker_icon.size=new google.maps.Size(d.iconsize[0],d.iconsize[1]),marker_icon.anchor=new google.maps.Point(d.iconanchor[0],d.iconanchor[1]),m.setIcon(marker_icon),d.shadow&&(marker_shadow=new google.maps.MarkerImage(d.shadow),marker_shadow.size=new google.maps.Size(d.shadowsize[0],d.shadowsize[1]),marker_shadow.anchor=new google.maps.Point(d.shadowanchor[0],d.shadowanchor[1]),s.setShadow(marker_shadow))):(m.setIcon(s.getIcon()),m.setShadow(s.getShadow())),g){"_latlng"==g&&(g=a+", "+n);var p=new google.maps.InfoWindow({content:r.html_prepend+g+r.html_append});google.maps.event.addListener(m,"click",function(){i&&i.close(),p.open(o,m),i=p}),l&&google.maps.event.addListenerOnce(o,"tilesloaded",function(){p.open(o,m)})}m.setMap(o),t.push(m)});for(var g=0;g<r.markers.length;g++)if(marker=r.markers[g],marker.address){"_address"==marker.html&&(marker.html=marker.address);var d=this;a.geocode({address:marker.address},function(o,a){return function(r){r&&r.length>0&&e(a).trigger("gMap.addMarker",[r[0].geometry.location.lat(),r[0].geometry.location.lng(),o.html,o.icon,o.popup])}}(marker,d))}else e(this).trigger("gMap.addMarker",[marker.latitude,marker.longitude,marker.html,marker.icon,marker.popup])})},e.fn.gMap.defaults={address:"",latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:!1,doubleclickzoom:!0,maptype:"ROADMAP",html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}}(jQuery);